# 卡片溶解特效 - 更新说明

## 🔥 最新更新 (2025-11-20)

### 1. 背景融合优化
- ✅ 未溶解部分现在显示为背景色 `#f5f3f0`（米白色）而非黑色
- ✅ 完美融合 MinimalistPage 的右侧区域背景
- ✅ 溶解效果更加自然和谐

### 2. 边框和阴影消失动画
- ✅ 卡片燃烧时，边框透明度逐渐降为 0
- ✅ 卡片燃烧时，阴影强度逐渐降为 0
- ✅ 消失速度为溶解速度的 2 倍（更快消失）
- ✅ 重置时恢复到原始样式

**动画细节：**
```javascript
// 边框透明度：从 0.4 降到 0
const borderOpacity = Math.max(0, (1 - fadeProgress * 2) * 0.4);

// 阴影强度：所有阴影同步降到 0
const shadowOpacity1 = Math.max(0, (1 - fadeProgress * 2) * 0.08);
const shadowOpacity2 = Math.max(0, (1 - fadeProgress * 2) * 0.05);
const shadowOpacity3 = Math.max(0, (1 - fadeProgress * 2) * 0.9);
const shadowOpacity4 = Math.max(0, (1 - fadeProgress * 2) * 0.02);
```

### 3. 组件自动销毁
- ✅ 燃烧完成后自动触发 `destroyed` 事件
- ✅ 父组件接收事件后移除该卡片组件
- ✅ 自动重置背景状态

**使用示例：**
```vue
<template>
  <MinimalCard
    v-if="cardVisible"
    number="01"
    title="标题"
    text="文字"
    subtitle="副标题"
    season="春"
    @destroyed="onCardDestroyed"
  />
</template>

<script setup>
import { ref } from 'vue';

const cardVisible = ref(true);

function onCardDestroyed() {
  // 卡片燃烧完成，移除组件
  cardVisible.value = false;
  console.log('卡片已被销毁');
}
</script>
```

## 📊 完整的溶解流程

```
1. 用户点击卡片
   ↓
2. 开始溶解动画
   ├─ Canvas 显示燃烧效果
   ├─ 边框逐渐变透明
   └─ 阴影逐渐消失
   ↓
3. 溶解进度 0% → 100%
   ├─ 橙黄色亮边出现
   ├─ 橙红色火焰扩散
   ├─ 深灰色灰烬蔓延
   └─ 最终完全透明
   ↓
4. 溶解完成 (progress >= 1.15)
   ├─ 触发 'destroyed' 事件
   └─ 父组件移除该组件
   ↓
5. 组件被销毁
   └─ 从 DOM 中移除
```

## 🎨 视觉效果时间线

```
时间    溶解进度    边框/阴影    视觉效果
────────────────────────────────────────────
0.0s      0%        100%       完整卡片
0.5s     25%         50%       边缘开始燃烧，边框变淡
1.0s     50%          0%       燃烧扩散，边框消失
1.5s     75%          0%       大部分溶解
2.0s    100%          0%       几乎完全消失
2.3s    115%          0%       触发销毁事件
```

## 🔧 技术实现

### MinimalCard.vue 关键代码

```javascript
// 1. 定义事件
const emit = defineEmits(['mouseenter', 'mouseleave', 'destroyed']);

// 2. 动画循环中更新边框和阴影
function animate() {
  if (!isAnimating) return;
  
  dissolveProgress += 0.005;
  
  // 更新边框和阴影
  if (cardElement.value) {
    const fadeProgress = Math.min(dissolveProgress / 1.0, 1);
    
    const borderOpacity = Math.max(0, (1 - fadeProgress * 2) * 0.4);
    cardElement.value.style.borderColor = `rgba(200, 190, 180, ${borderOpacity})`;
    
    const shadowOpacity1 = Math.max(0, (1 - fadeProgress * 2) * 0.08);
    // ... 其他阴影
    
    cardElement.value.style.boxShadow = `...`;
  }
  
  // 3. 完成时触发销毁
  if (dissolveProgress >= 1.15) {
    isAnimating = false;
    emit('destroyed');
    return;
  }
  
  renderDissolve();
  animationFrame = requestAnimationFrame(animate);
}

// 4. 重置时恢复原始样式
function stopDissolve() {
  // ...
  if (cardElement.value) {
    cardElement.value.style.borderColor = 'rgba(200, 190, 180, 0.4)';
    cardElement.value.style.boxShadow = `
      0 15px 50px rgba(0, 0, 0, 0.08),
      0 5px 15px rgba(0, 0, 0, 0.05),
      inset 0 1px 0 rgba(255, 255, 255, 0.9),
      inset 0 -1px 0 rgba(0, 0, 0, 0.02)
    `;
  }
}
```

### MinimalistPage.vue 集成

```javascript
// 1. 定义卡片状态
const cards = ref([
  { visible: true },
  { visible: true },
  { visible: true }
]);

// 2. 移除卡片函数
const removeCard = (index) => {
  cards.value[index].visible = false;
  // 重置背景
  if (currentBg.value === index + 1) {
    currentBg.value = 0;
  }
};

// 3. 在模板中使用
<MinimalCard
  v-if="cards[0].visible"
  @destroyed="removeCard(0)"
  ...
/>
```

## 🎯 使用场景

### 场景 1: 卡片删除动画
```vue
<!-- 用户点击删除按钮 -->
<button @click="deleteCard">删除</button>

<script setup>
const cardRef = ref(null);

function deleteCard() {
  // 触发溶解动画
  cardRef.value.startDissolve();
  // 燃烧完成后会自动触发 @destroyed 事件
}
</script>
```

### 场景 2: 游戏中的卡牌消失
```vue
<!-- 卡牌被使用后消失 -->
<MinimalCard
  v-if="card.exists"
  @click="useCard"
  @destroyed="onCardUsed"
/>

<script setup>
function useCard() {
  // 使用卡牌，自动开始溶解
  // 溶解完成后触发 onCardUsed
}

function onCardUsed() {
  card.exists = false;
  // 执行游戏逻辑
}
</script>
```

### 场景 3: 批量销毁
```vue
<button @click="burnAll">全部燃烧</button>

<script setup>
function burnAll() {
  // 延迟触发每张卡片的溶解
  cardRefs.value.forEach((card, index) => {
    setTimeout(() => {
      card.startDissolve();
    }, index * 300); // 间隔 300ms
  });
}
</script>
```

## 📝 注意事项

### 1. 性能考虑
- ✅ 单卡片溶解：60 FPS 流畅
- ⚠️ 同时溶解多张：建议不超过 5 张
- 💡 批量溶解时使用延迟触发

### 2. 状态管理
- 卡片销毁后无法恢复
- 如需重新显示，需要重新创建组件
- 建议在父组件中维护卡片数据

### 3. 事件处理
- `destroyed` 事件在溶解完成时触发
- 事件触发后应立即移除组件
- 避免在销毁后调用组件方法

## 🔄 与之前版本的对比

| 特性 | 之前版本 | 当前版本 |
|------|----------|----------|
| 未溶解部分 | 黑色遮罩 | 背景色融合 ✅ |
| 边框效果 | 保持不变 | 逐渐消失 ✅ |
| 阴影效果 | 保持不变 | 逐渐消失 ✅ |
| 组件生命周期 | 保留在 DOM | 自动销毁 ✅ |
| 事件通知 | 无 | destroyed 事件 ✅ |

## 🎊 总结

本次更新实现了：
1. ✅ 更自然的背景融合效果
2. ✅ 完整的边框和阴影消失动画
3. ✅ 自动组件销毁机制
4. ✅ 完善的事件通知系统

**现在的溶解效果更加真实、完整、自然！** 🔥✨

---

**更新日期**: 2025-11-20  
**版本**: 2.0.0  
**状态**: ✅ 完成并可用

