# 历史阅读功能使用指南

## 功能概述

为 NovelShowPage 添加了 Galgame 风格的历史阅读功能，玩家可以查看之前阅读过的对话内容。

## 使用方法

### 打开历史面板
- **鼠标滚轮向上滑动** - 在游戏界面中向上滚动鼠标滚轮，即可打开历史面板

### 关闭历史面板
- **右键点击** - 在历史面板打开时，右键点击任意位置即可关闭面板

### 浏览历史记录
- 历史面板打开后，可以使用鼠标滚轮上下滚动查看所有历史对话
- 每条历史记录包含：
  - 说话者名称（如果有）
  - 对话内容
  - 时间戳（显示阅读时间）

## 功能特性

### 1. 自动记录
- 自动记录所有 `text` 类型和 `choice` 类型的场景对话
- 包含说话者名称和对话内容
- 记录精确的时间戳

### 2. 历史限制
- 最多保留 **200 条**历史记录
- 超过限制时，自动删除最早的记录
- 保证性能不受影响

### 3. 存档集成
- 历史记录会随着存档一起保存
- 读档时会恢复对应的历史记录
- 支持快速存档/读档

### 4. 智能触发
- 只有在正常游戏界面时，滚轮向上才会触发历史面板
- 在以下情况下不会触发：
  - 系统菜单打开时
  - 选择界面显示时
  - 历史面板已经打开时

### 5. 精美设计
- 深色半透明背景，带毛玻璃效果
- 渐变色彩设计
- 鼠标悬停高亮效果
- 自定义滚动条样式
- 响应式布局，适配移动设备

## 技术实现

### 新增组件
- `web-project/src/components/visualNovel/HistoryPanel.vue` - 历史面板组件

### 修改文件
- `web-project/src/views/NovelShowPage.vue` - 集成历史功能

### 新增功能函数
- `addToHistory()` - 添加对话到历史记录
- `openHistoryPanel()` - 打开历史面板
- `closeHistoryPanel()` - 关闭历史面板
- `handleWheel()` - 处理滚轮事件
- `handleContextMenu()` - 处理右键事件

### 数据结构
每条历史记录包含：
```javascript
{
  speaker: string,      // 说话者名称
  text: string,         // 对话内容
  timestamp: string     // ISO 8601 格式的时间戳
}
```

## 快捷键/操作总结

| 操作 | 功能 |
|------|------|
| 滚轮向上 | 打开历史面板 |
| 右键 | 关闭历史面板 |
| 滚轮上下（在历史面板中） | 浏览历史记录 |

## 注意事项

1. 历史记录仅记录对话内容，不包括标题场景
2. 历史记录会随着游戏进度自动累积
3. 切换剧本时会清空历史记录
4. 历史面板阻止了默认右键菜单
5. 在历史面板中滚动不会影响游戏进度

## 未来扩展建议

- 添加搜索功能，可以搜索历史对话
- 添加筛选功能，按说话者筛选
- 添加导出功能，导出历史记录为文本文件
- 添加截图功能，截取喜欢的对话
- 支持点击历史记录跳转到对应场景（需要考虑选择分支的影响）

