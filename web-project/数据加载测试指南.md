# 📊 SowakaPage 数据加载测试指南

## 问题分析

之前页面显示为空的原因是 **字段命名不一致**：
- ❌ JavaScript 中使用了驼峰命名（`headerTitle`）
- ❌ HTML 模板中使用了下划线命名（`header_title`）

## 已修复的问题

✅ **统一字段命名为驼峰命名**：
- `header_title` → `headerTitle`
- `author_signature` → `authorSignature`  
- `image_url` → `imageUrl`

✅ **修复了三个地方**：
1. HTML 模板中的数据绑定（第60、66、73行）
2. JavaScript 数据对象定义（第206-212行）
3. 默认数据（loadDefaultData 函数中）

## 测试步骤

### 步骤 1：启动后端服务器

```bash
# 进入后端目录
cd backend

# 初始化 MongoDB 数据（如果还没初始化）
node src/scripts/initMongoDB.js

# 启动后端服务器
npm start
```

**预期输出**：
```
✅ MongoDB 连接成功
🚀 服务器运行在端口 3000
```

### 步骤 2：使用测试工具验证 API

打开浏览器，访问测试页面：
```
file:///C:/Users/PC/Desktop/untitled/web-project/test-api.html
```

或者直接在浏览器中打开 `web-project/test-api.html` 文件。

**应该看到**：
- ✅ 成功加载故事章节数据
- headerTitle: "そわかの物語"
- subtitle: "STORY OF SOWAKA"
- paragraphs: [4个段落]
- authorSignature: "— SOWAKA KYOTO"

### 步骤 3：启动前端项目

```bash
# 进入前端目录
cd web-project

# 启动开发服务器
npm run dev
```

访问 `http://localhost:5173/sowaka` 查看效果。

### 步骤 4：检查浏览器控制台

打开浏览器开发者工具（F12），在 Console 中应该看到：

```
🏠 开始加载房间数据...
✅ 成功加载 3 个房间
✅ 故事章节数据加载成功
标题：そわかの物語
段落数量：4
```

## 如何验证数据是否正确加载

### 1. 查看页面内容

在 "STORY OF SOWAKA" 部分，应该显示：

**标题**：
```
そわかの物語
STORY OF SOWAKA
```

**段落内容**：
```
京都の静かな朝、打ち水のされた石畳を歩くと、そこには時を超えた美しさが息づいています。

「そわか」は、古き良き日本の伝統と現代の洗練が調和した、特別な空間です。歴史的な建築を大切に保存しながら、現代の快適さを融合させました。

四季折々の京都の風景を感じながら、心安らぐひとときをお過ごしいただけます。坪庭の緑、石畳の音、風の香り。五感すべてで感じる日本の美がここにあります。

私たちは、訪れるすべての方に「幸あれ」という祝福の心を込めて、最高のおもてなしを提供いたします。
```

**作者签名**：
```
— SOWAKA KYOTO
```

### 2. 使用 Vue DevTools

安装 Vue DevTools 浏览器扩展后：
1. 打开开发者工具
2. 选择 "Vue" 标签
3. 找到 `SowakaPage` 组件
4. 查看 `storySection` ref 的值

应该显示：
```javascript
{
  headerTitle: "そわかの物語",
  subtitle: "STORY OF SOWAKA",
  paragraphs: [
    "京都の静かな朝...",
    "「そわか」は...",
    "四季折々の...",
    "私たちは..."
  ],
  authorSignature: "— SOWAKA KYOTO",
  imageUrl: "/images/sowaka-story.jpg"
}
```

## 常见问题排查

### 问题 1：页面仍然显示为空

**原因**：可能是浏览器缓存问题

**解决方案**：
1. 按 `Ctrl + Shift + R` 强制刷新
2. 清除浏览器缓存
3. 在开发者工具的 Network 标签中勾选 "Disable cache"

### 问题 2：控制台显示 "加载内容失败"

**原因**：后端服务器未启动或端口不对

**解决方案**：
1. 确认后端服务器在运行（`cd backend && npm start`）
2. 检查端口是否为 3000
3. 访问 `http://localhost:3000/api/mongo/story-sections/active` 测试 API

### 问题 3：API 返回数据为空

**原因**：数据库未初始化

**解决方案**：
```bash
cd backend
node src/scripts/initMongoDB.js
```

### 问题 4：显示默认数据而不是数据库数据

**原因**：API 请求失败，触发了后备方案

**解决方案**：
1. 检查浏览器控制台的错误信息
2. 确认 MongoDB 服务正在运行
3. 检查 `.env` 文件中的数据库配置

## 数据流程图

```
1. 页面加载
   ↓
2. onMounted() 执行
   ↓
3. loadContents() 调用
   ↓
4. storySectionApi.getActiveStorySections()
   ↓
5. 发送请求到: http://localhost:3000/api/mongo/story-sections/active
   ↓
6. 后端返回数据
   ↓
7. 解析响应: section.headerTitle, section.paragraphs, etc.
   ↓
8. 更新 storySection.value
   ↓
9. Vue 响应式系统触发重新渲染
   ↓
10. 模板中的 {{ storySection.headerTitle }} 显示数据
```

## 字段映射表

| 数据库字段 (MongoDB) | JavaScript 对象 | HTML 模板 |
|---------------------|----------------|-----------|
| headerTitle         | storySection.headerTitle | {{ storySection.headerTitle }} |
| subtitle            | storySection.subtitle | {{ storySection.subtitle }} |
| paragraphs          | storySection.paragraphs | v-for="paragraph in storySection.paragraphs" |
| authorSignature     | storySection.authorSignature | {{ storySection.authorSignature }} |
| imageUrl            | storySection.imageUrl | :src="storySection.imageUrl" |

## 下一步

如果数据显示正常，你可以：
1. 在后端修改数据库内容
2. 添加更多段落
3. 上传并设置图片 URL
4. 调整样式和布局

## 需要帮助？

如果仍有问题，请提供：
1. 浏览器控制台的完整错误信息
2. Network 标签中 API 请求的响应内容
3. Vue DevTools 中 storySection 的值


