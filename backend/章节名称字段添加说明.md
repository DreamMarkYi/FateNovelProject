# Sowaka Stories 章节名称字段添加说明

## 概述
为MongoDB数据库的`sowaka_stories`表单添加了新的`chapterName`字段，用于显示大章节的名称。此更新不会重新初始化表，而是在原有表的基础上进行扩展。

## 更新内容

### 1. 数据库Schema更新
**文件**: `backend/src/schemas/sowakaStorySchema.js`

添加了新字段：
```javascript
chapterName: {
  type: String,
  trim: true,
  default: '第一章'
}
```

### 2. 数据库迁移脚本
**文件**: `backend/src/scripts/addChapterNameField.js`

- 自动为现有记录添加`chapterName`字段
- 根据`displayOrder`自动生成章节名称（第1章、第2章等）
- 提供详细的迁移日志和统计信息

**运行方式**:
```bash
cd backend
node src/scripts/addChapterNameField.js
```

### 3. API控制器更新
**文件**: `backend/src/controllers/mongo/sowakaStoryController.js`

#### 新增功能：
- 创建新故事时自动生成章节名称
- 新增根据章节名称获取故事的API方法

#### 新增API端点：
- `GET /api/mongo/sowaka-stories/chapter/:chapterName` - 根据章节名称获取故事

### 4. 路由更新
**文件**: `backend/src/routes/mongo/sowakaStoryRoutes.js`

添加了新的路由：
```javascript
router.get('/chapter/:chapterName', SowakaStoryController.getSowakaStoryByChapter);
```

### 5. 前端组件更新
**文件**: `web-project/src/components/sowaka/SowakaStorySection.vue`

#### 显示更新：
- 在故事标题上方显示章节名称
- 添加了优雅的章节名称样式，包含下划线装饰
- 响应式设计支持移动端显示

#### 样式特点：
- 金色主题色彩 (`#c9a96e`)
- 大写字母显示
- 居中对齐
- 装饰性下划线

## API使用示例

### 获取所有故事（包含章节信息）
```javascript
GET /api/mongo/sowaka-stories
```

### 根据章节名称获取故事
```javascript
GET /api/mongo/sowaka-stories/chapter/第一章
```

### 创建新故事（自动生成章节名称）
```javascript
POST /api/mongo/sowaka-stories
{
  "title": "新的故事标题",
  "subtitle": "故事副标题",
  "storyTextRight": ["故事内容段落1", "故事内容段落2"],
  // chapterName 会自动生成
}
```

### 创建新故事（指定章节名称）
```javascript
POST /api/mongo/sowaka-stories
{
  "title": "新的故事标题",
  "subtitle": "故事副标题",
  "chapterName": "序章",
  "storyTextRight": ["故事内容段落1", "故事内容段落2"]
}
```

## 数据迁移步骤

1. **备份数据库**（推荐）
   ```bash
   mongodump --db your_database_name --collection sowaka_stories
   ```

2. **运行迁移脚本**
   ```bash
   cd backend
   node src/scripts/addChapterNameField.js
   ```

3. **验证迁移结果**
   - 脚本会自动显示迁移统计信息
   - 检查所有记录是否都包含`chapterName`字段

## 前端显示效果

章节名称会显示在故事标题上方，具有以下特点：
- 金色文字 (`#c9a96e`)
- 大写字母显示
- 4px字母间距
- 底部装饰线
- 响应式设计

## 注意事项

1. **向后兼容**: 所有现有API保持不变，新字段为可选
2. **自动生成**: 创建新故事时如未指定章节名称，会自动生成
3. **数据完整性**: 迁移脚本会检查并确保所有记录都有章节名称
4. **前端适配**: 前端组件会自动检查并显示章节名称（如果存在）

## 测试建议

1. **API测试**: 使用Postman或类似工具测试新的API端点
2. **前端测试**: 检查章节名称在不同设备上的显示效果
3. **数据一致性**: 验证所有现有记录都正确添加了章节名称

## 故障排除

如果遇到问题，请检查：
1. MongoDB连接是否正常
2. 迁移脚本是否成功执行
3. 前端API调用是否正确
4. 浏览器控制台是否有错误信息
